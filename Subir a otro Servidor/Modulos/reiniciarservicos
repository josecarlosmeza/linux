#!/bin/bash
clear
fun_prog ()
{
	comando[0]="$1" 
    ${comando[0]}  > /dev/null 2>&1 & 
	tput civis
	echo -ne "\033[1;32m.\033[1;33m.\033[1;31m. \033[1;32m"
    while [ -d /proc/$! ]
	do
		for i in / - \\ \|
		do
			sleep .1
			echo -ne "\e[1D$i"
		done
	done
	tput cnorm
	echo -e "\e[1DOK"
}
# AlmaLinux/RHEL: systemctl (sshd); Debian: service (ssh)
_restart_svc() { command -v systemctl &>/dev/null && systemctl restart "$1" 2>/dev/null || service "$1" restart 2>/dev/null; }
echo -ne "\033[1;33mREINICIANDO OPENSSH "; fun_prog '_restart_svc sshd || _restart_svc ssh'
echo ""
sleep 1
if [[ -e /etc/squid/squid.conf ]]; then
echo -ne "\033[1;33mREINICIANDO SQUID PROXY "; fun_prog '_restart_svc squid'
echo ""
sleep 1
elif [[ -e /etc/squid3/squid.conf ]]; then
echo -ne "\033[1;33mREINICIANDO SQUID PROXY "; fun_prog '_restart_svc squid3'
echo ""
sleep 1
fi
if [[ -e /etc/stunnel/stunnel.conf || -e /etc/stunnel4/stunnel.conf ]]; then
echo -ne "\033[1;33mREINICIANDO SSL TUNNEL "; fun_prog '_restart_svc stunnel4'
echo ""
sleep 1
fi
if [[ -e /etc/init.d/dropbear ]]; then
echo -ne "\033[1;33mREINICIANDO DROPBEAR "; fun_prog '_restart_svc dropbear'
echo ""
sleep 1
fi
if command -v netstat &>/dev/null; then _web=$(netstat -nltp 2>/dev/null | grep -E 'apache2|httpd'); else _web=$(ss -nltp 2>/dev/null | grep -E 'apache2|httpd'); fi
if [[ -n "$_web" ]] || [[ -e /etc/init.d/apache2 ]] || (command -v systemctl &>/dev/null && (systemctl is-active --quiet httpd 2>/dev/null || systemctl is-active --quiet apache2 2>/dev/null)); then
echo -ne "\033[1;33mREINICIANDO APACHE/HTTPD "; fun_prog '_restart_svc httpd; _restart_svc apache2; [[ -x /etc/init.d/apache2 ]] && /etc/init.d/apache2 restart 2>/dev/null'
echo ""
sleep 1
fi
echo -e "\033[1;32mServicios reiniciados correctamente.\033[0m"
sleep 1
